TIME /T > HORAINI.TXT

SET ROOTDIR=Z:\apps\pascal
SET SGHCDIR=%ROOTDIR%\SGHC
SET TAR="%ProgramFiles%\GnuWin32\bin\tar.exe"
SET BZIP2="%ProgramFiles%\GnuWin32\bin\bzip2.exe"
SET DBUTILS=%ROOTDIR%\DBUTILS\DBUTILS.EXE
SET InnoSetup="%ProgramFiles%\Inno Setup 5\COMPIL32.EXE"

REM MD ..\BIN
REM MD ..\OBJ

REM CD %SGHCDIR%\SOURCE
REM Compiling ...
SET UPATH=%ROOTDIR%\RX\UNITS;%ROOTDIR%\ARCTL\SOURCE;%ROOTDIR%\ARCTLEX\SOURCE;..\OBJ
SET UPATH=%UPATH%;%ROOTDIR%\TB97\SOURCE;%ROOTDIR%\NAVBTN;%ROOTDIR%\BZip2;%ROOTDIR%\UNITS;%ROOTDIR%\kbmmemtb;%ROOTDIR%\AEXCEL\FREE.SRC
DCC32 -B -U%UPATH% %SGHCDIR%\SOURCE\HORCOLEG.DPR
SET UPATH=
REM Now compressing executable if ASPack is present ...
if exist "%ProgramFiles%\ASPack\aspack.exe" START /W "%ProgramFiles%\ASPack\aspack.exe" ..\BIN\HORCOLEG.EXE

REM CREANDO LA DISTRIBUCION EN FUENTE
DEL %SGHCDIR%/sghcsrc.tar.bz2
COPY %DBUTILS% %SGHCDIR%\SOURCE\DBUTILS.EXE
%TAR% -cv -C %SGHCDIR% -T %SGHCDIR%\filelist.txt -f %SGHCDIR%\sghcsrc.tar
%BZIP2% %SGHCDIR%\sghcsrc.tar

DEL /Q %SGHCDIR%\DAT\*

REM CREANDO LA BASE DE DATOS DE PARADOX A PARTIR DE LA BASE DE DATOS DE ACCESS
%DBUTILS% /ACC2PDX %SGHCDIR%\SOURCE\SGHC.MDB ..\DAT

REM CREANDO LA BASE DE DATOS EMPACADA
%DBUTILS% /DBPACK %SGHCDIR%\DAT %SGHCDIR%\BIN\HORCOLEG.DB0

REM DEL /Q %SGHCDIR%\DAT\*

REM VERIFIQUE QUE EL ARCHIVO DE AYUDA ESTE COMPILADO

REM CREANDO LOS INSTALADORES

if not exist %InnoSetup% GOTO 1
CD ..\INSTALL
DEL /S %SGHCDIR%\COMPLETO\*
DEL /S %SGHCDIR%\PARCIAL\*
%InnoSetup% /cc HORPARCL.ISS
%InnoSetup% /cc HORCOMPL.ISS
RENAME COMPLETO\SETUP.EXE INSTALAR.EXE
RENAME PARCIAL\SETUP.EXE INSTALAR.EXE
COPY %SGHCDIR%\DOC\LEAME.TXT %SGHCDIR%\INSTALL\COMPLETO\
COPY %SGHCDIR%\DOC\LEAME.TXT %SGHCDIR%\INSTALL\PARCIAL\
GOTO 2
:1
ECHO NO SE ELABORARON LOS INSTALADORES DEBIDO A QUE NO SE ENCUENTRA EL INNO SETUP
:2
CD ..\BAT
TIME /T > HORAFIN.TXT
